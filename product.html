<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/e739b303fd.js" crossorigin="anonymous"></script>
    <title>Pruebas</title>
</head>
<body data-theme="dark" id="body">
    <header class="row sticky-top d-flex justify-content-center align-items-center mx-0 header">
        <nav class="col-lg-8 col-11 justify-content-lg-between justify-content-center align-items-center d-flex flex-row header--nav">
            <div class="col-6 align-items-center justify-content-start d-flex flex-row">
                <a href="index.html" class="col-4 text-center header--nav__title">ENGINE</a>
                <a href="browse.html" class="col-3 d-lg-block d-none text-center header--nav__subtitle">BROWSE</a>
            </div>
            <div class="col-6 justify-content-center align-items-center d-lg-flex d-none flex-row contenedorCambiante">
                <div class="col-6">
                    <div class="col-12 d-flex flex-row">
                        <input type="text" placeholder="Search" class="col-10 align-self-center header--nav__search-input">
                        <button class="col-2 align-self-center header--nav__search-button"><i class="col-12 text-center fa-solid fa-magnifying-glass"></i></button>
                    </div>
                    <div class="col-12 align-self-end header--nav__search-bar"></div>
                </div>
            </div>
            <li class="col-lg-0 col-6 text-center justify-content-end d-lg-none d-flex"><button class=" col-2 header--button" onclick="mostrarHeader()"><i class="fa-solid fa-lg fa-bars"></i></button></li>
        </nav>
        <div class="col-12 align-items-center d-flex flex-column justify-content-between position-absolute overflow-hidden header--flex-menu" id="responsiveHeaderDiv">
            <button class="col-1 mt-4 align-self-end header--button" onclick="ocultarHeader()"><i class="fa-solid fa-xl fa-xmark"></i></button>
            <div class="col-8 text-center">
                <div class="col-12 mt-4 mb-5">
                    <div class="col-12 d-flex flex-row">
                        <input type="text" placeholder="Search" class="col-11 align-self-center header--flex__search-input">
                        <i class="col-1 text-center align-self-center fa-solid fa-xl fa-magnifying-glass"></i>
                    </div>
                    <div class="col-12 align-self-end header--flex__search-bar"></div>
                </div>
                <li class="col-12 my-4 header--flex__subtitle">BROWSE</li>
                <li class="col-12 my-4 header--flex__subtitle">PROFILE</li>
                <li class="col-12 my-4 header--flex__subtitle">CART</li>
                <li class="col-12 my-4 header--flex__subtitle">SETTINGS</li>
            </div>
            <div class="col-8 text-center">
                <li class="col-12 my-4 header--flex__subtitle">LOG OUT</li>
            </div>
        </div>
        <script>
            function mostrarHeader() {
                let div = document.getElementById("responsiveHeaderDiv");
                let body = document.getElementById("body");

                div.style.transform = "translateX(0px)";
                body.style.overflowY = hidden;
            }

            function ocultarHeader() {
                let div = document.getElementById("responsiveHeaderDiv");
                let body = document.getElementById("body");

                div.style.transform = "translateX(101%)";
                body.style.overflowY = auto;
            }

            function getLocalStorageVariables() {
                if (localStorage.getItem("logged_in") == null) {
                    localStorage.setItem("logged_in", "false");
                    localStorage.setItem("user_id", "none");
                    localStorage.setItem("user_type", "none");
                }

                if (localStorage.getItem("logged_in") == "true") {
                    document.querySelector(".contenedorCambiante").innerHTML += '<button class="col-3 mx-3 border-0 text-center header--nav__subtitle" onclick="logout();">LOG OUT</button><button class="col-1 align-self-center header--nav__cart-button"><i class="col-12 text-center fa-solid fa-cart-shopping"></i></button>';

                    document.querySelector(".contenedorCambiante2").innerHTML += '<a href="profile.html?q=' + localStorage.getItem("user_id") + '" class="col-3 d-lg-block d-none text-center header--nav__subtitle">PROFILE</a>';
                } else {
                    document.querySelector(".contenedorCambiante").innerHTML += '<a href="login.html" class="col-3 mx-1 text-center header--nav__subtitle">LOG IN</a><button class="col-1 align-self-center header--nav__cart-button"><i class="col-12 text-center fa-solid fa-cart-shopping"></i></button>';
                }
            }

            getLocalStorageVariables()

            function logout() {
                localStorage.setItem("logged_in", "false");
                localStorage.setItem("user_id", "none");
                localStorage.setItem("user_type", "none");

                window.location.href = "index.html";
            }
        </script>
    </header>
    <div class="row d-flex justify-content-center product--body">
        <div class="row px-0 py-0 overflow-hidden product--bannerContainer">
            <img class="row mx-0 my-0 product--banner" src="" alt="Videogame's banner image">
        </div>
        <div class="col-8 product--content">
            <div class="row mb-5 d-flex flex-row justify-content-between">
                <div class="col-4 px-0 d-flex flex-column">
                    <img class="img-fluid mb-4 rounded shadow-lg product--image" src="" alt="">
                    <div class="row px-2 d-flex flex-row justify-content-between product--buttonsContainer">
                        <button type="button" class="col-9 btn d-flex justify-content-center align-items-center rounded shadow-lg product--button">
                            <p class="my-2 fw-bolder">ADD TO CART</p>
                        </button>
                        <button type="button" class="col-2 btn d-flex justify-content-center align-items-center rounded shadow-lg product--button">
                            <i class="my-2 fa-regular fa-heart"></i>
                        </button>
                    </div>
                </div>
                <div class="col-7 d-flex flex-column">
                    <div class="row d-flex flex-row mb-5 align-items-center">
                        <p class="w-auto fs-2 fw-bolder product--title"></p>
                        <p class="w-auto fs-5 product--price"></p>
                    </div>
                    <div class="row d-flex flex-row justify-content-between mb-3">
                        <div class="col-8 d-flex flex-row product--tags">
                        </div>
                        <div class="col-3 text-center d-flex flex-row justify-content-end align-items-center">
                            <p class="my-0 px-2 py-2 fs-6 rounded-pill shadow-lg product--tag product--releaseDate"></p>
                        </div>
                    </div>
                    <p class="fs-6 fw-bolder product--description"></p>
                </div>
            </div>
            <div class="row mb-2 d-flex flex-column">
                <p class="w-auto fs-3 fw-bold product--title">TRAILER</p>
                <div class="game__bottom-content-trailer">
                    <div class="game__bottom-content-video">
                        <video class="product--video shadow-lg" controls><source type="video/webm"/>Your browser does not support the video tag.</video>
                    </div>
                </div>
            </div>
            <div class="row mb-5 d-flex flex-column">
                <p class="w-auto fs-3 fw-bold product--title">SCREENSHOTS</p>
                <div class="game__image-carousel" data-carousel-position="1">
                </div>
                <script>
                    function setupCarousel(carouselContainer) {
                        var carouselContainers;

                        if (typeof carouselContainer !== "undefined") {
                        if (Array.isArray(carouselContainer)) {
                            carouselContainers = carouselContainer;
                        } else {
                            carouselContainers = [carouselContainer];
                        }
                        } else {
                        carouselContainers = Array.prototype.slice.apply(
                            document.getElementsByClassName("game__image-carousel")
                        );
                        }

                        carouselContainers.forEach(function (containerElement) {
                        var carousel = {};
                        var prevArrows, nextArrows;

                        // Capture carousel elements
                        carousel.container = containerElement;
                        carousel.images = Array.prototype.slice.apply(
                            containerElement.getElementsByClassName("game__image-carousel__image")
                        );
                        carousel.position = 1;

                        // Get prev/next arrows
                        prevArrows = Array.prototype.slice.apply(
                            carousel.container.getElementsByClassName("game__image-carousel-prev-arrow")
                        );
                        nextArrows = Array.prototype.slice.apply(
                            carousel.container.getElementsByClassName("game__image-carousel-next-arrow")
                        );

                        function setPrevImage() {
                            if (carousel.position == 1) {
                            carousel.position = carousel.images.length;
                            } else {
                            carousel.position = carousel.position - 1;
                            }
                            carousel.container.dataset.carouselPosition = carousel.position;
                        }

                        function setNextImage() {
                            if (carousel.position == carousel.images.length) {
                            carousel.position = 1;
                            } else {
                            carousel.position = carousel.position + 1;
                            }
                            carousel.container.dataset.carouselPosition = carousel.position;
                        }

                        function onKeyPress(evt) {
                            switch (evt.which) {
                            case 37: // Left arrow
                                setPrevImage();
                                break;
                            case 39: // Right arrow
                                setNextImage();
                                break;
                            }
                        }

                        prevArrows.forEach(function (prevArrow) {
                            prevArrow.addEventListener("click", setPrevImage);
                        });
                        nextArrows.forEach(function (nextArrow) {
                            nextArrow.addEventListener("click", setNextImage);
                        });
                        window.addEventListener("keyup", onKeyPress);
                        });
                    }
                </script>
            </div>
        </div>
    </div>
    <div class=" col-12">
        <footer class="py-2 my-0">
          <p class="text-center text-body-secondary"> Creado por Genaro Filograsso, Adriano Plandolit y Bautista Pérez &copy; 2023</p>
        </footer>
    </div>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", () => {
            const boton = document.querySelector(".navbar-burger");
            const menu = document.querySelector(".navbar-menu");
            if (boton != null) {
                boton.onclick = () => {
                    menu.classList.toggle("is-active");
                    boton.classList.toggle("is-active");
                };
            }
        });

        function loadGameData() {
            let queryStrings = new URLSearchParams(window.location.search);
            let idProducto = queryStrings.get("q");

            const getGameData = new XMLHttpRequest();
            getGameData.responseType = 'text';
            getGameData.onload = function () {
                let jsonResponse = JSON.parse(this.response);

                document.querySelector(".product--banner").src = "https://cdn.cloudflare.steamstatic.com/steam/apps/" + jsonResponse[0].steamId + "/library_hero.jpg?t=1698341791";
                document.querySelector(".product--banner").alt = jsonResponse[0].nombre + "'s banner image";

                document.querySelector(".product--image").src = "https://cdn.cloudflare.steamstatic.com/steam/apps/" + jsonResponse[0].steamId + "/header.jpg?t=1698341791";
                document.querySelector(".product--image").alt = jsonResponse[0].nombre + "'s main image";

                document.querySelector(".product--title").innerText = jsonResponse[0].nombre;

                document.querySelector(".product--price").innerText = "$ " + jsonResponse[0].precio + ".00";

                let fechas = jsonResponse[0].fechaDeSalida.split("-");
                switch (fechas[1]) {
                    case "01":
                        fechas[1] = "Jan";
                        break;
                    case "02":
                        fechas[1] = "Feb";
                        break;
                    case "03":
                        fechas[1] = "Mar";
                        break;
                    case "04":
                        fechas[1] = "Apr";
                        break;
                    case "05":
                        fechas[1] = "May";
                        break;
                    case "06":
                        fechas[1] = "Jun";
                        break;
                    case "07":
                        fechas[1] = "Jul";
                        break;
                    case "08":
                        fechas[1] = "Aug";
                        break;
                    case "09":
                        fechas[1] = "Sep";
                        break;
                    case "10":
                        fechas[1] = "Oct";
                        break;
                    case "11":
                        fechas[1] = "Nov";
                        break;
                    case "12":
                        fechas[1] = "Dec";
                        break;
                }
                if (fechas[2].slice(0, 1) == "0") {
                    fechas[2] = fechas[2].slice(1);
                }
                document.querySelector(".product--releaseDate").innerText = fechas[2] + " " + fechas[1] + ", " + fechas[0];

                document.querySelector(".product--description").innerText = jsonResponse[0].descripcion;

                document.querySelector(".product--video").src = jsonResponse[0].trailer;
            }
            getGameData.open("GET", "api/productos/obtener.php?id=" + idProducto);
            getGameData.setRequestHeader("Cache-Control", 'no-store');
            getGameData.send();

            const getGameGenres = new XMLHttpRequest();
            getGameGenres.responseType = 'text';
            getGameGenres.onload = function () {
                let jsonResponse = JSON.parse(this.response);

                jsonResponse.forEach(element => {
                    document.querySelector(".product--tags").innerHTML += '<p class="mx-1 my-0 px-3 py-2 fs-6 rounded-pill shadow-lg product--tag">' + element.nombre + '</p>';
                });
            }
            getGameGenres.open("GET", "api/generos/obtenerGenerosDeJuego.php?id=" + idProducto);
            getGameGenres.setRequestHeader("Cache-Control", 'no-store');
            getGameGenres.send();

            const getGameImages = new XMLHttpRequest();
            getGameImages.responseType = 'text';
            getGameImages.onload = function () {
                let jsonResponse = JSON.parse(this.response);

                document.querySelector(".game__image-carousel").innerHTML += '<a class="game__image-carousel-prev-arrow">❮</a>';
                for (let i = 1; i < (jsonResponse.length + 1); i++) {
                    document.querySelector(".game__image-carousel").innerHTML += '<a href="' + jsonResponse[i - 1].ruta + '" target="_blank" data-game__image-carousel-index="' + i + '"><img src="' + jsonResponse[i - 1].ruta + '" class="game__image-carousel__image shadow-lg" data-game__image-carousel-index="' + i + '"></a>';
                }
                document.querySelector(".game__image-carousel").innerHTML += '<a class="game__image-carousel-next-arrow">❯</a>';

                setupCarousel();
            }
            getGameImages.open("GET", "api/imagenes/obtenerImagenesDeJuego.php?id=" + idProducto);
            getGameImages.setRequestHeader("Cache-Control", 'no-store');
            getGameImages.send();
        }

        loadGameData();

    </script>
    
</body>
</html>